<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <style type="text/css"> .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.external):nth-child(3) > .nav-list > .nav-list-item:nth-child(3) > .nav-list-link { display: block; font-weight: 600; text-decoration: none; background-image: linear-gradient(-90deg, rgb(234.8, 236.82, 244.9) 0%, rgba(234.8, 236.82, 244.9, 0.8) 80%, rgba(234.8, 236.82, 244.9, 0) 100%); } .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:nth-child(3) > .nav-list-expander svg, .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:nth-child(3) > .nav-list > .nav-list-item:nth-child(3) > .nav-list-expander svg { transform: rotate(-90deg); } .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:nth-child(3) > .nav-list, .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:nth-child(3) > .nav-list > .nav-list-item:nth-child(3) > .nav-list { display: block; } .site-nav > .nav-category-list > .nav-list-item > .nav-list-expander svg { transform: rotate(-90deg); } .site-nav > .nav-category-list > .nav-list-item > .nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Running jobs | EESRF HPC User Guide</title> <meta name="generator" content="Jekyll v4.4.1" /> <meta property="og:title" content="Running jobs" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="User guide of HPC at EESRF" /> <meta property="og:description" content="User guide of HPC at EESRF" /> <link rel="canonical" href="https://qingli411.github.io/eesrf-hpc-user-guide/hpc2/running_jobs.html" /> <meta property="og:url" content="https://qingli411.github.io/eesrf-hpc-user-guide/hpc2/running_jobs.html" /> <meta property="og:site_name" content="EESRF HPC User Guide" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Running jobs" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"User guide of HPC at EESRF","headline":"Running jobs","url":"https://qingli411.github.io/eesrf-hpc-user-guide/hpc2/running_jobs.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> EESRF HPC User Guide </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in HPC1 category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/hpc1/" class="nav-list-link">HPC1</a><ul class="nav-list"><li class="nav-list-item"><a href="/hpc1/connecting.html" class="nav-list-link">Connecting</a></li><li class="nav-list-item"><a href="/hpc1/environment.html" class="nav-list-link">Environment</a></li><li class="nav-list-item"><a href="/hpc1/running_jobs.html" class="nav-list-link">Running jobs</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in HPC2 category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/hpc2/" class="nav-list-link">HPC2</a><ul class="nav-list"><li class="nav-list-item"><a href="/hpc2/connecting.html" class="nav-list-link">Connecting</a></li><li class="nav-list-item"><a href="/hpc2/environment.html" class="nav-list-link">Environment</a></li><li class="nav-list-item"><a href="/hpc2/running_jobs.html" class="nav-list-link">Running jobs</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search EESRF HPC User Guide" aria-label="Search EESRF HPC User Guide" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/qingli411/eesrf-hpc-user-guide" class="site-button" > View page source </a> </li> </ul> </nav> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/hpc2/">HPC2</a></li> <li class="breadcrumb-nav-list-item"><span>Running jobs</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 id="running-jobs"> <a href="#running-jobs" class="anchor-heading" aria-labelledby="running-jobs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Running jobs </h1> <h2 id="slurm"> <a href="#slurm" class="anchor-heading" aria-labelledby="slurm"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Slurm </h2> <p>We use <a href="https://slurm.schedmd.com">Slurm</a> for cluster management and job scheduling. See <a href="https://slurm.schedmd.com/quickstart.html">here</a> for a more detailed user guide of Slurm.</p> <h2 id="submitting-jobs"> <a href="#submitting-jobs" class="anchor-heading" aria-labelledby="submitting-jobs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Submitting jobs </h2> <p>As mentioned <a href="connecting.html#note">here</a>, you are not allowed to directly run jobs on the login node. Instead, you may submit a job to the computing nodes via Slurm. There are basically two ways you can submit a job as briefly introduced below.</p> <h3 id="batch-jobs"> <a href="#batch-jobs" class="anchor-heading" aria-labelledby="batch-jobs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Batch jobs </h3> <p>You can use <code class="language-plaintext highlighter-rouge">sbatch</code> to submit a job script for later execution. A typical job script begins with a <a href="https://en.wikipedia.org/wiki/Shebang_%28Unix%299">shebang</a> line (e.g., <code class="language-plaintext highlighter-rouge">#!/bin/bash</code>) followed by lines of Slurm directives each begins with <code class="language-plaintext highlighter-rouge">#SBATCH</code>. These directives tell Slurm some basic information about the job, such as a job name, a filename to save output and error message, the computational resource a job requires, including the number of nodes and CPU cores, and the <em>wall time</em> (job execution time in real world, as would be seen on a clock mounted on the wall, after which the job will be cancelled automatically), etc. After these directives, users then include the commands to be run in the script, including the setting of environment variables and the setup of the job. This is the recommended way to submit a job. Below is an example job script to submit a test case of <a href="https://mpas-dev.github.io/ocean/ocean.html">MPAS-Ocean</a>.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c">#SBATCH  --job-name=MPASO           # job name ('MPASO' in this example)</span>
<span class="c">#SBATCH  --output=MPASO.%j          # save output message to MPASO.%j where %j is the job ID assigned by Slurm</span>
<span class="c">#SBATCH  --nodes=1                  # number of node requested (1 in this example)</span>
<span class="c">#SBATCH  --ntasks-per-node=16       # number of MPI tasks per node (16 in this example)</span>
<span class="c">#SBATCH  --time=1:00:00             # wall time requested (one hour in this example)</span>

<span class="c"># load necessary modules</span>
module purge
module load intel openmpi zlib hdf5 pnetcdf netcdf pio fftw

<span class="c"># set environment variables for MPAS-Ocean</span>
<span class="nb">export </span><span class="nv">NETCDF</span><span class="o">=</span><span class="k">${</span><span class="nv">NETCDF_ROOT</span><span class="k">}</span>
<span class="nb">export </span><span class="nv">PNETCDF</span><span class="o">=</span><span class="k">${</span><span class="nv">PNETCDF_ROOT</span><span class="k">}</span>
<span class="nb">export </span><span class="nv">PIO</span><span class="o">=</span><span class="k">${</span><span class="nv">PIO_ROOT</span><span class="k">}</span>
<span class="nb">export </span><span class="nv">FFTW</span><span class="o">=</span><span class="k">${</span><span class="nv">FFTW_ROOT</span><span class="k">}</span>
<span class="nb">export </span><span class="nv">CORE</span><span class="o">=</span>ocean
<span class="nb">export </span><span class="nv">AUTOCLEAN</span><span class="o">=</span><span class="nb">true
export </span><span class="nv">USE_PIO2</span><span class="o">=</span><span class="nb">false</span>

<span class="c"># go to the case directory and run the case</span>
<span class="nv">case_path</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">HOME</span><span class="k">}</span><span class="s2">/scratch/mpas/ocean/mixed_layer_eddy/0.6km/single_front/forward"</span>
<span class="nb">cd</span> <span class="k">${</span><span class="nv">case_path</span><span class="k">}</span>
mpirun <span class="nt">-n</span> <span class="k">${</span><span class="nv">SLURM_NTASKS</span><span class="k">}</span> ./ocean_model <span class="nt">-n</span> namelist.ocean <span class="nt">-s</span> streams.ocean

</code></pre></div></div> <h3 id="interactive-jobs"> <a href="#interactive-jobs" class="anchor-heading" aria-labelledby="interactive-jobs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Interactive jobs </h3> <p>You can also use <code class="language-plaintext highlighter-rouge">salloc</code> to allocate resources for an interactive job so that you can SSH to the allocated computing node and run the job interactively as you would do on your personal computer. To allocate one node for one hour, run</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; salloc --nodes=1 --time=1:00:00
salloc: Granted job allocation 13804
salloc: Waiting for resource configuration
salloc: Nodes node03 are ready for job
</code></pre></div></div> <p>As shown in the prompt message above, <code class="language-plaintext highlighter-rouge">node03</code> is allocated. You can then SSH to the allocated node by <code class="language-plaintext highlighter-rouge">ssh node03</code> and run your job interactively. This is usually used for testing and debugging.</p> <p>Note that you will not be able to directly SSH to a computing node without an allocation.</p> <h2 id="other-useful-slurm-commands"> <a href="#other-useful-slurm-commands" class="anchor-heading" aria-labelledby="other-useful-slurm-commands"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Other useful Slurm commands </h2> <ul> <li><code class="language-plaintext highlighter-rouge">sinfo</code> shows the state of partitions and nodes managed by Slurm. For example, to check the state of all 19 nodes, run</li> </ul> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; sinfo
PARTITION AVAIL  TIMELIMIT  NODES  STATE NODELIST
x86_64*      up   infinite      1    mix node01
x86_64*      up   infinite     16   idle node[02-17]
x86_64_02    up   infinite      2   idle node[18-19]
</code></pre></div></div> <p>We have two partitions: <code class="language-plaintext highlighter-rouge">x86_64</code> for regular computing nodes and <code class="language-plaintext highlighter-rouge">x86_64_02</code> for large memory nodes. <code class="language-plaintext highlighter-rouge">sinfo</code> has a wide variety of filtering, sorting, and formatting options. Run <code class="language-plaintext highlighter-rouge">man sinfo</code> to learn more.</p> <ul> <li><code class="language-plaintext highlighter-rouge">squeue</code> shows the state of jobs or job steps. For example, to see the state of the MPAS-Ocean job, run</li> </ul> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; squeue
             JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)
             13802    x86_64    MPASO   qingli  R       0:05      1 node02
</code></pre></div></div> <p>It also has a wide variety of filtering, sorting, and formatting options. By default, it reports the running jobs in priority order and then the pending jobs in priority order. Run <code class="language-plaintext highlighter-rouge">man squeue</code> to learn more.</p> <ul> <li><code class="language-plaintext highlighter-rouge">scancel</code> is used to cancel a pending or running job or job step. For example, to cancel the above job with job ID of <code class="language-plaintext highlighter-rouge">13802</code>, run</li> </ul> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt; scancel 13802
</code></pre></div></div> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
